---
import Layout from "~/layouts/Layout.astro";
import Section from "~/components/Section.astro";
import Heading from "~/components/Heading.astro";
---

<Layout pageTitle="سبد خرید - دان حیات" title="سبد خرید" description="سبد خرید شما">
	<Section class:list={"bg-white"}>
		<Heading>
			<h4 slot="heading-title" class="font-black text-brand-brown h3">سبد خرید</h4>
			<p slot="heading-content">
				محصولات انتخاب شده شما
			</p>
		</Heading>

		<div x-data="cartStore" x-init="init()" class="mt-8">
			<!-- Empty Cart State -->
			<div x-show="items.length === 0" class="text-center py-16">
				<i class="fa-solid fa-cart-shopping w-24 h-24 mx-auto mb-6 text-gray-300 text-6xl"></i>
				<h3 class="text-2xl font-bold text-gray-600 mb-4">سبد خرید شما خالی است</h3>
				<p class="text-gray-500 mb-8">محصولات مورد نظر خود را به سبد خرید اضافه کنید</p>
				<a href="/products" class="bg-brand-sand hover:bg-brand-sand/80 text-white font-bold py-3 px-8 rounded-lg transition-colors">
					مشاهده محصولات
				</a>
			</div>

			<!-- Cart Items -->
			<div x-show="items.length > 0" class="space-y-6">
				<!-- Cart Items List -->
				<div class="bg-white rounded-lg shadow-lg p-6">
					<div class="space-y-4">
						<template x-for="item in items" :key="item.id">
							<div class="flex items-center space-x-4 p-4 border-b border-gray-100 last:border-b-0">
								<!-- Product Image -->
								<div class="flex-shrink-0">
									<img :src="item.image" :alt="item.name" class="w-20 h-20 object-cover rounded-lg">
								</div>
								
								<!-- Product Info -->
								<div class="flex-1">
									<h3 class="text-lg font-bold text-brand-brown" x-text="item.name"></h3>
									<p class="text-sm text-gray-600" x-text="formatPrice(item.price)"></p>
								</div>
								
								<!-- Quantity Controls -->
								<div class="flex items-center space-x-3">
									<button 
										@click="updateQuantity(item.id, item.quantity - 1)"
										class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm hover:bg-gray-200 transition-colors"
									>
										-
									</button>
									<span class="text-lg font-medium w-12 text-center" x-text="item.quantity"></span>
									<button 
										@click="updateQuantity(item.id, item.quantity + 1)"
										class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm hover:bg-gray-200 transition-colors"
									>
										+
									</button>
								</div>
								
								<!-- Item Total -->
								<div class="text-right">
									<p class="text-lg font-bold text-brand-brown" x-text="formatPrice(item.price * item.quantity)"></p>
								</div>
								
								<!-- Remove Button -->
								<button 
									@click="removeItem(item.id)"
									class="text-red-500 hover:text-red-700 transition-colors"
									title="حذف از سبد خرید"
								>
									<i class="fa-solid fa-trash text-lg"></i>
								</button>
							</div>
						</template>
					</div>
				</div>

				<!-- Cart Summary -->
				<div class="bg-white rounded-lg shadow-lg p-6">
					<div class="space-y-4">
						<div class="flex justify-between items-center text-lg">
							<span class="font-medium text-gray-700">تعداد محصولات:</span>
							<span class="font-bold text-brand-brown" x-text="getTotalItems()"></span>
						</div>
						<div class="flex justify-between items-center text-xl">
							<span class="font-bold text-gray-800">مجموع کل:</span>
							<span class="font-bold text-brand-brown text-2xl" x-text="formatPrice(getTotalPrice())"></span>
						</div>
					</div>
				</div>

				<!-- Action Buttons -->
				<div class="flex flex-col sm:flex-row gap-4">
					<button 
						@click="clearCart()"
						class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2"
					>
						<span>پاک کردن سبد خرید</span>
					</button>
					<a 
						href="/products"
						class="flex-1 bg-brand-sand hover:bg-brand-sand/80 text-white font-bold py-3 px-6 rounded-lg transition-colors text-center flex items-center justify-center space-x-2"
					>
						<span>ادامه خرید</span>
					</a>
					<a href="/checkout"
						class="flex-1 bg-brand-brown hover:bg-brand-brown/80 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2"
					>
						<span>تکمیل خرید</span>
					</a>
				</div>
			</div>
		</div>
	</Section>
</Layout>

<script>
  // Import cart store
  import { cartStore } from '../components/CartStore.js';
  
  // Make cart store available globally
  if (typeof window !== 'undefined') {
    (window as any).cartStore = cartStore;
  }
</script>
